<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Random encoders for sentence classification | datitos</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Random encoders for sentence classification" />
<meta name="author" content="Mat√≠as Battocchia" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="üê± Codificadores aleatorios para embeddings de oraciones" />
<meta property="og:description" content="üê± Codificadores aleatorios para embeddings de oraciones" />
<link rel="canonical" href="https://matiasbattocchia.github.io/datitos/Random-sentence-encoders.html" />
<meta property="og:url" content="https://matiasbattocchia.github.io/datitos/Random-sentence-encoders.html" />
<meta property="og:site_name" content="datitos" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-10-28T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://matiasbattocchia.github.io/datitos/Random-sentence-encoders.html","@type":"BlogPosting","headline":"Random encoders for sentence classification","dateModified":"2020-10-28T00:00:00-05:00","datePublished":"2020-10-28T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://matiasbattocchia.github.io/datitos/Random-sentence-encoders.html"},"author":{"@type":"Person","name":"Mat√≠as Battocchia"},"description":"üê± Codificadores aleatorios para embeddings de oraciones","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/datitos/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://matiasbattocchia.github.io/datitos/feed.xml" title="datitos" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-174296382-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/datitos/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/datitos/">datitos</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/datitos/about/">Acerca de</a><a class="page-link" href="/datitos/search/">B√∫squeda</a><a class="page-link" href="/datitos/categories/">Contenidos</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Random encoders for sentence classification</h1><p class="page-description">üê± Codificadores aleatorios para embeddings de oraciones</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-10-28T00:00:00-05:00" itemprop="datePublished">
        Oct 28, 2020
      </time>‚Ä¢ 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Mat√≠as Battocchia</span></span>
       ‚Ä¢ <span class="read-time" title="Estimated read time">
    
    
      11 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/datitos/categories/#nlp">nlp</a>
        &nbsp;
      
        <a class="category-tags-link" href="/datitos/categories/#charla">charla</a>
        &nbsp;
      
        <a class="category-tags-link" href="/datitos/categories/#paper">paper</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/matiasbattocchia/datitos/tree/master/_notebooks/2020-10-28-Random-sentence-encoders.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/datitos/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          <div class="px-2">
    <a href="https://colab.research.google.com/github/matiasbattocchia/datitos/blob/master/_notebooks/2020-10-28-Random-sentence-encoders.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/datitos/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-10-28-Random-sentence-encoders.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Charla basada en este paper:</p>
<p><a href="https://arxiv.org/pdf/1901.10444.pdf">https://arxiv.org/pdf/1901.10444.pdf</a></p>
<blockquote><p>A complex pattern-classification problem, cast in a high-dimensional space nonlinearly, is more likely to be linearly separable than in a low-dimensional space, provided that the space is not densely populated.</p>
</blockquote>
<p>‚Äî‚ÄâCover, T. M.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Word-embeddings">Word embeddings<a class="anchor-link" href="#Word-embeddings"> </a></h2><p>Palabra $\rightarrow$ t√≥ken.</p>
<p>Embedding: representaci√≥n de densa y de baja dimensionalidad de un t√≥ken.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Aproximaciones no supervisadas basadas en la <a href="https://en.wikipedia.org/wiki/Distributional_semantics">hip√≥tesis distribucional</a>: palabras que ocurren en el mismo contexto tienden a tener significados similares.</p>
<p><img src="/datitos/images/copied_from_nb/images/word_embedding1.png" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Word embeddings pre-entrenados:</p>
<ul>
<li>word2vec</li>
<li>GloVe</li>
<li>fastText</li>
<li>ELMo</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Sentence-embeddings">Sentence embeddings<a class="anchor-link" href="#Sentence-embeddings"> </a></h2><p>Oraci√≥n $\rightarrow$ documento.</p>
<p>T√©cnica sencilla y aceptable: <strong>max</strong> o <strong>mean</strong> de los t√≥kenes del documento.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>La intenci√≥n es usar un clasificador sobre los embeddings de documentos (<em>downstream task</em>).</p>
<p><img src="/datitos/images/copied_from_nb/images/sentence_embedding2.png" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>O simplemente una medida de similaridad.</p>
<p><img src="/datitos/images/copied_from_nb/images/sentence_embedding1.png" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tareas-y-datasets">Tareas y datasets<a class="anchor-link" href="#Tareas-y-datasets"> </a></h2><p><a href="https://arxiv.org/pdf/1705.02364.pdf">https://arxiv.org/pdf/1705.02364.pdf</a></p>
<h4 id="Clasificaci&#243;n">Clasificaci&#243;n<a class="anchor-link" href="#Clasificaci&#243;n"> </a></h4><ul>
<li>sentiment analysis (MR, SST),</li>
<li>product reviews (CR),</li>
<li>subjectivity (SUBJ),</li>
<li>opinion polarity (MPQA),</li>
<li>question-type (TREC).</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/datitos/images/copied_from_nb/images/senteval1.png" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Inferencia-y-similaridad-sem&#225;ntica">Inferencia y similaridad sem&#225;ntica<a class="anchor-link" href="#Inferencia-y-similaridad-sem&#225;ntica"> </a></h4><ul>
<li>entailment (SNLI, SICK-E),</li>
<li>semantic relatedness (SICK-R, STS),</li>
<li>paraphrasing (MRPC).</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/datitos/images/copied_from_nb/images/senteval2.png" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Encoders-entrenados">Encoders entrenados<a class="anchor-link" href="#Encoders-entrenados"> </a></h2><p>$h = f_Œ∏(e_1, \ldots, e_n)$</p>
<ul>
<li>Interesa obtener una representaci√≥n $h$ de una <strong>oraci√≥n</strong>,</li>
<li>usando alguna funci√≥n $f$ parametrizada por $Œ∏$,</li>
<li>en funci√≥n de embeddings pre-entrenados $e$ donde $e_i$ es la representaci√≥n de la i-√©sima <strong>palabra</strong> en una oraci√≥n de largo $n$.</li>
</ul>
<p>T√≠picamente los codificadores aprenden $Œ∏$, par√°metros que luego se mantien fijos en las tareas de transferencia.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="InferSent">InferSent<a class="anchor-link" href="#InferSent"> </a></h3><p><a href="https://arxiv.org/abs/1705.02364">https://arxiv.org/abs/1705.02364</a></p>
<p>Supervisado usando el corpus Stanford Natural Language Inference (SNLI). Requiere una gran cantidad de anotaciones.</p>
<p><img src="/datitos/images/copied_from_nb/images/infersent1.png" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/datitos/images/copied_from_nb/images/infersent2.png" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Skip-Thought">Skip-Thought<a class="anchor-link" href="#Skip-Thought"> </a></h3><p><a href="https://arxiv.org/abs/1506.06726">https://arxiv.org/abs/1506.06726</a></p>
<p>No supervisado. En vez de predecir las palabras que envuelven a una palabra (<em>skip-gram</em>), predice las oraciones alrededor de una oraci√≥n dada. Entrenarlo lleva un tiempo muy largo.</p>
<p><img src="/datitos/images/copied_from_nb/images/seq2seq.png" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/datitos/images/copied_from_nb/images/skip-thought.png" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Random-encoders">Random encoders<a class="anchor-link" href="#Random-encoders"> </a></h2><p>Diferentes maneras de parametrizar $f$ para representar el significado de oraciones sin ning√∫n entrenamiento de $Œ∏$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Bag-of-random-embedding-projections">Bag of random embedding projections<a class="anchor-link" href="#Bag-of-random-embedding-projections"> </a></h3><p>$X = (e_1, \ldots, e_n)$</p>
<ul>
<li>$X ‚àà \mathbb{R}^{n√óD}$.</li>
<li>$n$ es el tama√±o del documento, $D$ es la dimensi√≥n de los <em>word embeddings</em>.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>$h = f_{\text{pool}}(X W)$</p>
<ul>
<li>$W ‚àà \mathbb{R}^{D√ód}$ se inicializa al azar usando una distribuci√≥n uniforme entre $[\frac{‚àí1}{\sqrt{d}}, \frac{1}{\sqrt{d}}]$.</li>
<li>$D$ es la dimensi√≥n de los <em>word embeddings</em>, $d$ es la dimensi√≥n de la proyecci√≥n.</li>
<li>$f_{\text{pool}} = \text{max}$ (<em>max pooling</em>) o $f_{\text{pool}} = \text{mean}$ (<em>mean pooling</em>).</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Random-LSTMs">Random LSTMs<a class="anchor-link" href="#Random-LSTMs"> </a></h3><p>$h =  f_{\text{pool}}(\text{BiLSTM}(e_1, \ldots, e_n))$</p>
<ul>
<li>Los pesos se inicializan al azar usando una distribuci√≥n uniforme entre $[\frac{‚àí1}{\sqrt{d}}, \frac{1}{\sqrt{d}}]$.</li>
<li>$d$ es la dimensi√≥n del estado oculto de la LSTM.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Echo-state-networks-(ESNs)">Echo state networks (ESNs)<a class="anchor-link" href="#Echo-state-networks-(ESNs)"> </a></h3><p><img src="/datitos/images/copied_from_nb/images/esn1.png" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/datitos/images/copied_from_nb/images/esn2.jpg" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>$(\hat y_1, \ldots, \hat y_n) = \text{ESN}(e_1, \ldots, e_n)$</p>
<p>Descripci√≥n formal de una ESN:</p>
<p>$\tilde h_i = f_{\text{act}} (W^i e_i + W^h h_{i‚àí1} + b^i)$</p>
<p>$h_i = (1‚àíŒ±) h_{i‚àí1} + Œ± \tilde h_i$</p>
<ul>
<li>$W^i$, $W^h$, $b^i$ son inicializados al azar y no se actualizan durante el entrenamiento.</li>
<li>$Œ± ‚àà (0,1]$ es el grado de mezcla entre el estado previo y el actual.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>$\hat y_i = W^o [e_i;h_i] + b^o$</p>
<ul>
<li>$W^o$, $b^o$ son los √∫nicos parametros que se entrenan.</li>
<li>$\hat y_i$ es la predicci√≥n para $y_i$.</li>
<li><strong>NO SE USA</strong>.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>$h = f_{\text{pool}}(\text{BiESN}(e_1, \ldots, e_n))$</p>
<ul>
<li>Se utiliza una ESN bidireccional, los estados del reservorio de ambas direcciones se concatenan $h_i = [\overrightarrow{h_i};\overleftarrow{h_i}]$.</li>
<li>Mediante <em>pooling</em> de estos estados se obtiene la representaci√≥n de la oraci√≥n $h$.</li>
</ul>
<p>La <em>echo state property</em> clama que el estado del reservorio debe ser √∫nicamente determinada por la historia de entrada y que los efectos de un estado dado deben disminuir en favor de estados m√°s recientes. En la pr√°ctica esta propiedad se satisface asegurando que el valor absoluto del autovalor m√°s grande de $W^h$ sea menor que 1.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Resultados">Resultados<a class="anchor-link" href="#Resultados"> </a></h3><p><img src="/datitos/images/copied_from_nb/images/random.png" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Parte-2:-C&#243;digo-(BOREP)">Parte 2: C&#243;digo (BOREP)<a class="anchor-link" href="#Parte-2:-C&#243;digo-(BOREP)"> </a></h2><p>Vamos a intentar la estrategia de <em>bag of random embeddings projection</em>.</p>
<p><a href="https://github.com/dair-ai/emotion_dataset">https://github.com/dair-ai/emotion_dataset</a></p>

<pre><code>sadness üò¢
joy üòÉ
love ü•∞
anger üò°
fear üò±
surprise üòØ</code></pre>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;max_colwidth&#39;</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s1">&#39;datasets/emotions.pkl&#39;</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">emotions</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>joy         141067
sadness     121187
anger        57317
fear         47712
love         34554
surprise     14972
Name: emotions, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">emotion</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">emotions</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;emotions == @emotion&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">emotion</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">sample</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* &#39;</span> <span class="o">+</span> <span class="n">text</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SADNESS
* i feel shitty about my looks which makes me feel shitty as a person
* i started feeling a few things here and there under me feet or when something messy
* i put it aside feeling a little defeated
* i feel devastated when i fail
* i shut it down reminding myself that i have no time for this feeling burdened by the compulsion to do something about all my thoughts


JOY
* i feel like all of the colors put together look cool even if they arent realistic
* i feel almost too trusting
* i feel hopeful somehow and like i am climbing back up from this pit
* i feel super happy when i see other people going off for a holiday
* i start out feeling very confident positive about my choices and way more together than the stammering person i just painted myself into a second ago i often get this kind of doomsday response


LOVE
* i walk by animal stores or see people walking their pets i feel a sense of longing for my own animals
* i were cool but sometimes i had this gut feeling that she wasn t fond of me
* i expect to beaten down to give until i feel as if i can give no more to love without being loved always to continually pray to feel pain for my children and because of my children
* i feel like i am expending a lot of effort in supporting them with very little return emotional support
* i thought it would be a good time to check in on weasel nation to see how they were feeling about their donut loving coach and their floundering football team


ANGER
* when some seniors tried to scold and insult some juniors on account of what the juniors were supposed to have said at secondary school
* i feel so angry with the person that i have lost and i feel like it is going to consume me at times
* i feel a little greedy about these books i got in the mail today
* i can really feel those people who insulted the other races
* i feels like the type of people who would not bother with such petty crimes but that is what i said about grell beforehand


FEAR
* i could just embrace feeling weird instead of clinging to what i think is normal
* im starting to feel really nervous about all the work that has to be done in the new house john says why
* i got so used to the pain that it actually feels weird to be up and functioning instead of being in the usual fetal position
* i began to feel very shy and unable to concentrate on my words
* im beginning to feel unsure about my current relationship after catching up with my friend jen who was at socc and heard all about her experiences abroad has made wonder what i am doing


SURPRISE
* i feel fuckin dazed
* i feel dazed when im with him
* i feel like falling in love with her is part of being amazed at how she makes our family so much better she tells the advocate
* i really feel amazed and ashamed at the same time when people say that such a move wont end things the way they are and wont mark a new beginning
* i have always had an issue with my weight and stomach fat so this feels weird


</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Revisando las muestras nos damos cuentas de que es un dataset bastante pol√©mico.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Tokenizaci&#243;n">Tokenizaci&#243;n<a class="anchor-link" href="#Tokenizaci&#243;n"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">text</span><span class="p">]</span>

<span class="n">docs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;i&#39;, &#39;was&#39;, &#39;feeling&#39;, &#39;a&#39;, &#39;little&#39;, &#39;low&#39;, &#39;few&#39;, &#39;days&#39;, &#39;back&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Indexaci&#243;n">Indexaci&#243;n<a class="anchor-link" href="#Indexaci&#243;n"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="k">class</span> <span class="nc">Vocab</span><span class="p">():</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">√≠ndice_relleno</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapeo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t√≥ken_relleno</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t√≥ken_desconocido</span><span class="o">=</span><span class="s1">&#39;&lt;unk&gt;&#39;</span><span class="p">,</span> <span class="n">t√≥ken_relleno</span><span class="o">=</span><span class="s1">&#39;&lt;pad&gt;&#39;</span><span class="p">,</span> <span class="n">frecuencia_m√≠nima</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">frecuencia_m√°xima</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">longitud_m√≠nima</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">longitud_m√°xima</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">stop_words</span><span class="o">=</span><span class="p">[],</span> <span class="n">l√≠mite_vocabulario</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">t√≥ken_desconocido</span> <span class="o">=</span> <span class="n">t√≥ken_desconocido</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t√≥ken_relleno</span> <span class="o">=</span> <span class="n">t√≥ken_relleno</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frecuencia_m√≠nima</span> <span class="o">=</span> <span class="n">frecuencia_m√≠nima</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frecuencia_m√°xima</span> <span class="o">=</span> <span class="n">frecuencia_m√°xima</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">longitud_m√≠nima</span> <span class="o">=</span> <span class="n">longitud_m√≠nima</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">longitud_m√°xima</span> <span class="o">=</span> <span class="n">longitud_m√°xima</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_words</span> <span class="o">=</span> <span class="n">stop_words</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l√≠mite_vocabulario</span> <span class="o">=</span> <span class="n">l√≠mite_vocabulario</span>
    
    <span class="k">def</span> <span class="nf">reducir_vocabulario</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lote</span><span class="p">):</span>
        <span class="n">contador_absoluto</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">lote</span><span class="p">))</span>
        
        <span class="n">contador_documentos</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">lote</span><span class="p">:</span>
            <span class="n">contador_documentos</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">doc</span><span class="p">))</span>
        
        <span class="c1"># frecuencia m√≠nima</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frecuencia_m√≠nima</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span> <span class="c1"># frecuencia de t√≥ken</span>
            <span class="n">vocabulario_m√≠n</span> <span class="o">=</span> <span class="p">[</span><span class="n">t√≥ken</span> <span class="k">for</span> <span class="n">t√≥ken</span><span class="p">,</span> <span class="n">frecuencia</span> <span class="ow">in</span> <span class="n">contador_absoluto</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span> <span class="k">if</span> <span class="n">frecuencia</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frecuencia_m√≠nima</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># frecuencia de documento</span>
            <span class="n">vocabulario_m√≠n</span> <span class="o">=</span> <span class="p">[</span><span class="n">t√≥ken</span> <span class="k">for</span> <span class="n">t√≥ken</span><span class="p">,</span> <span class="n">frecuencia</span> <span class="ow">in</span> <span class="n">contador_documentos</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span> <span class="k">if</span> <span class="n">frecuencia</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">lote</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frecuencia_m√≠nima</span><span class="p">]</span>
        
        <span class="c1"># frecuencia m√°xima</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frecuencia_m√°xima</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span> <span class="c1"># frecuencia de t√≥ken</span>
            <span class="n">vocabulario_m√°x</span> <span class="o">=</span> <span class="p">[</span><span class="n">t√≥ken</span> <span class="k">for</span> <span class="n">t√≥ken</span><span class="p">,</span> <span class="n">frecuencia</span> <span class="ow">in</span> <span class="n">contador_absoluto</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frecuencia_m√°xima</span> <span class="o">&gt;=</span> <span class="n">frecuencia</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># frecuencia de documento</span>
            <span class="n">vocabulario_m√°x</span> <span class="o">=</span> <span class="p">[</span><span class="n">t√≥ken</span> <span class="k">for</span> <span class="n">t√≥ken</span><span class="p">,</span> <span class="n">frecuencia</span> <span class="ow">in</span> <span class="n">contador_documentos</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frecuencia_m√°xima</span> <span class="o">&gt;=</span> <span class="n">frecuencia</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">lote</span><span class="p">)]</span>

        <span class="c1"># intersecci√≥n de vocabulario_m√≠n y vocabulario_m√°x preservando el √≥rden</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocabulario_m√≠n</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocabulario_m√°x</span><span class="p">):</span>
            <span class="n">vocabulario</span> <span class="o">=</span> <span class="n">vocabulario_m√≠n</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vocabulario</span> <span class="o">=</span> <span class="p">[</span><span class="n">t√≥ken</span> <span class="k">for</span> <span class="n">t√≥ken</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">vocabulario_m√≠n</span><span class="p">,</span> <span class="s1">&#39;Procesando documentos&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">t√≥ken</span> <span class="ow">in</span> <span class="n">vocabulario_m√°x</span><span class="p">]</span>

        <span class="c1"># longitud</span>
        <span class="n">vocabulario</span> <span class="o">=</span> <span class="p">[</span><span class="n">t√≥ken</span> <span class="k">for</span> <span class="n">t√≥ken</span> <span class="ow">in</span> <span class="n">vocabulario</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">longitud_m√°xima</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t√≥ken</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longitud_m√≠nima</span><span class="p">]</span>
        
        <span class="c1"># stop words</span>
        <span class="n">vocabulario</span> <span class="o">=</span> <span class="p">[</span><span class="n">t√≥ken</span> <span class="k">for</span> <span class="n">t√≥ken</span> <span class="ow">in</span> <span class="n">vocabulario</span> <span class="k">if</span> <span class="n">t√≥ken</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_words</span><span class="p">]</span>
        
        <span class="c1"># l√≠mite</span>
        <span class="n">vocabulario</span> <span class="o">=</span> <span class="n">vocabulario</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">l√≠mite_vocabulario</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">vocabulario</span>
        
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lote</span><span class="p">):</span>
        <span class="n">vocabulario</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t√≥ken_relleno</span><span class="p">:</span>
            <span class="n">vocabulario</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t√≥ken_relleno</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t√≥ken_desconocido</span><span class="p">:</span>
            <span class="n">vocabulario</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t√≥ken_desconocido</span><span class="p">)</span>
        
        <span class="n">vocabulario</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducir_vocabulario</span><span class="p">(</span><span class="n">lote</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mapeo</span> <span class="o">=</span> <span class="p">{</span><span class="n">t√≥ken</span><span class="p">:</span> <span class="n">√≠ndice</span> <span class="k">for</span> <span class="n">√≠ndice</span><span class="p">,</span> <span class="n">t√≥ken</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vocabulario</span><span class="p">)}</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lote</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t√≥ken_desconocido</span><span class="p">:</span> <span class="c1"># reemplazar</span>
            <span class="k">return</span> <span class="p">[[</span><span class="n">t√≥ken</span> <span class="k">if</span> <span class="n">t√≥ken</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapeo</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">t√≥ken_desconocido</span> <span class="k">for</span> <span class="n">t√≥ken</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">lote</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># ignorar</span>
            <span class="k">return</span> <span class="p">[[</span><span class="n">t√≥ken</span> <span class="k">for</span> <span class="n">t√≥ken</span> <span class="ow">in</span> <span class="n">doc</span> <span class="k">if</span> <span class="n">t√≥ken</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapeo</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">lote</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">t√≥kenes_a_√≠ndices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lote</span><span class="p">):</span>
        <span class="n">lote</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">lote</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">mapeo</span><span class="p">[</span><span class="n">t√≥ken</span><span class="p">]</span> <span class="k">for</span> <span class="n">t√≥ken</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">lote</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">√≠ndices_a_t√≥kenes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lote</span><span class="p">):</span>
        <span class="n">mapeo_inverso</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapeo</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        
        <span class="k">return</span> <span class="p">[[</span><span class="n">mapeo_inverso</span><span class="p">[</span><span class="n">√≠ndice</span><span class="p">]</span> <span class="k">for</span> <span class="n">√≠ndice</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">lote</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapeo</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vocabulario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">mapeo</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">obtener_embeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fastText</span><span class="p">):</span>

        <span class="n">embeddings</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">fastText</span><span class="p">[</span><span class="n">t√≥ken</span><span class="p">]</span> <span class="k">for</span> <span class="n">t√≥ken</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocabulario</span>
            <span class="k">if</span> <span class="n">t√≥ken</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t√≥ken_desconocido</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t√≥ken_relleno</span><span class="p">)</span>
        <span class="p">]</span>
        
        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t√≥ken_desconocido</span><span class="p">:</span>
            <span class="n">unk</span> <span class="o">=</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">unk</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t√≥ken_relleno</span><span class="p">:</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fastText</span><span class="o">.</span><span class="n">get_dimension</span><span class="p">())</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">pad</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">embeddings</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">Vocab</span><span class="p">(</span><span class="n">t√≥ken_desconocido</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">t√≥ken_relleno</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">v</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>75302</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">v</span><span class="o">.</span><span class="n">t√≥kenes_a_√≠ndices</span><span class="p">([[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;was&#39;</span><span class="p">,</span> <span class="s1">&#39;feeling&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;few&#39;</span><span class="p">,</span> <span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="s1">&#39;back&#39;</span><span class="p">]])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[[0, 23, 5, 6, 53, 409, 187, 162, 98]]</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Representaciones-pre-entrenadas">Representaciones pre-entrenadas<a class="anchor-link" href="#Representaciones-pre-entrenadas"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fasttext</span>
<span class="kn">import</span> <span class="nn">fasttext.util</span>

<span class="n">fasttext</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">download_model</span><span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">ft</span> <span class="o">=</span> <span class="n">fasttext</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s1">&#39;cc.en.300.bin&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">obtener_embeddings</span><span class="p">(</span><span class="n">ft</span><span class="p">)</span>

<span class="n">e</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([75302, 300])</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">idxs</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">t√≥kenes_a_√≠ndices</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span> <span class="n">idxs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">]</span>

<span class="n">x</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([9, 300])</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Representaciones-de-oraciones">Representaciones de oraciones<a class="anchor-link" href="#Representaciones-de-oraciones"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">D</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">d</span> <span class="o">=</span> <span class="mi">512</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>

<span class="n">w</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([300, 512])</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xw</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

<span class="n">xw</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([9, 512])</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xw</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([512])</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span> <span class="p">[</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">doc</span><span class="p">],</span> <span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">idxs</span><span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Representaciones-de-emociones">Representaciones de emociones<a class="anchor-link" href="#Representaciones-de-emociones"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">emo</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;sadness&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;joy&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;love&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;anger&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;fear&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;surprise&#39;</span><span class="p">],</span>
<span class="p">]</span>

<span class="n">emo_idxs</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">t√≥kenes_a_√≠ndices</span><span class="p">(</span><span class="n">emo</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">emo_sents</span> <span class="o">=</span> <span class="p">[</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">doc</span><span class="p">],</span> <span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">emo_idxs</span> <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Distancia-entre-oraciones">Distancia entre oraciones<a class="anchor-link" href="#Distancia-entre-oraciones"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">PairwiseDistance</span><span class="p">(</span><span class="n">p</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>

<span class="n">d</span><span class="p">(</span><span class="n">emo_sents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">emo_sents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([8635.8857])</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dist</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span> <span class="p">[</span><span class="n">d</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sent</span><span class="p">)</span> <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">emo_sents</span><span class="p">)],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>

<span class="n">dist</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">indices</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="M&#233;tricas">M&#233;tricas<a class="anchor-link" href="#M&#233;tricas"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;sadness&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;joy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;love&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;anger&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;fear&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;surprise&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;y_true&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">emotions</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>

<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="n">labels</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>              precision    recall  f1-score   support

     sadness       0.43      0.00      0.01    121187
         joy       0.51      0.00      0.01    141067
        love       0.17      0.03      0.05     34554
       anger       0.14      0.23      0.18     57317
        fear       0.11      0.19      0.14     47712
    surprise       0.04      0.56      0.07     14972

    accuracy                           0.08    416809
   macro avg       0.23      0.17      0.07    416809
weighted avg       0.35      0.08      0.05    416809

</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Muy tristes estos resultados üò¢. Quiz√°s random sentence encoders funcione m√°s para entrenar clasificadores m√°s que para medidas de similaridad.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="BOE">BOE<a class="anchor-link" href="#BOE"> </a></h2><p>Dado que la estrategia anterior no funcion√≥, veamos qu√© sucede con la cl√°sica <em>bag of embeddings</em>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Representaciones-de-oraciones">Representaciones de oraciones<a class="anchor-link" href="#Representaciones-de-oraciones"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([300])</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span> <span class="p">[</span> <span class="n">e</span><span class="p">[</span><span class="n">doc</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">idxs</span><span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Representaciones-de-emociones">Representaciones de emociones<a class="anchor-link" href="#Representaciones-de-emociones"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">emo_sents</span> <span class="o">=</span> <span class="p">[</span> <span class="n">e</span><span class="p">[</span><span class="n">doc</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">emo_idxs</span> <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Distancia-entre-oraciones">Distancia entre oraciones<a class="anchor-link" href="#Distancia-entre-oraciones"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dist</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span> <span class="p">[</span><span class="n">d</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sent</span><span class="p">)</span> <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">emo_sents</span><span class="p">)],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>

<span class="n">dist</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">indices</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="M&#233;tricas">M&#233;tricas<a class="anchor-link" href="#M&#233;tricas"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="n">labels</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>              precision    recall  f1-score   support

     sadness       0.31      0.22      0.25    121187
         joy       0.52      0.00      0.01    141067
        love       0.17      0.02      0.04     34554
       anger       0.14      0.72      0.24     57317
        fear       0.32      0.01      0.02     47712
    surprise       0.04      0.09      0.06     14972

    accuracy                           0.17    416809
   macro avg       0.25      0.18      0.10    416809
weighted avg       0.34      0.17      0.12    416809

</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Embedding-a-embbeding">Embedding a embbeding<a class="anchor-link" href="#Embedding-a-embbeding"> </a></h2><p>Dado que la estrategia anterior no funcion√≥, veamos qu√© sucede con la m√°s cl√°sica todav√≠a comparaci√≥n palabra a palabra usando embeddings de palabras sin proyecci√≥n. Vamos a comparar cada palabra del documento con la palabra de emoci√≥n y nos quedaremos con la distancia m√°s corta para determinar la distancia del documento a la emoci√≥n.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dist</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">emo_sents</span><span class="p">:</span>
    <span class="c1"># distancia de cada embedding (t√≥ken) del documento a la emoci√≥n</span>
    <span class="n">distancias_docs</span> <span class="o">=</span> <span class="p">[</span> <span class="n">d</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">doc</span><span class="p">],</span> <span class="n">sent</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">]</span>
        
    <span class="n">dist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span> <span class="n">distancias_docs</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">dist</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">dist</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([416809, 6])</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">indices</span>

<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="n">labels</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>              precision    recall  f1-score   support

     sadness       0.52      0.02      0.04    121187
         joy       0.53      0.00      0.01    141067
        love       0.19      0.06      0.10     34554
       anger       0.34      0.01      0.01     57317
        fear       0.33      0.01      0.02     47712
    surprise       0.04      0.96      0.07     14972

    accuracy                           0.05    416809
   macro avg       0.33      0.18      0.04    416809
weighted avg       0.43      0.05      0.03    416809

</pre>
</div>
</div>

</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="matiasbattocchia/datitos"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/datitos/Random-sentence-encoders.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/datitos/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/datitos/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/datitos/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Tutoriales de ciencia de datos | CC BY-SA 4.0</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>
